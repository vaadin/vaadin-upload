<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../vaadin-button/vaadin-button.html">
<link rel="import" href="vaadin-upload-ajax-uploader.html">
<link rel="import" href="vaadin-upload-dropzone.html">
<link rel="import" href="vaadin-upload-file.html">
<link rel="import" href="vaadin-upload-icons.html">
<link rel="import" href="vaadin-upload-multiple.html">

<dom-module id="vaadin-upload-default-theme" theme-for="vaadin-upload">
  <template>
    <style>
      :host {
        display: block;
      }

      [part="drop-label-icon"] {
        font-family: 'vaadin-upload-icons';
      }

      [part="drop-label-icon"]::before {
        content: "\e905";
      }
    </style>
  </template>
</dom-module>

<dom-module id="vaadin-upload">
  <template>
    <vaadin-upload-dropzone disabled$="[[nodrop]]">
      <vaadin-upload-multiple id="upload"
        slot="upload"
        files="{{files}}"
        accept="[[accept]]"
        max-files="[[maxFiles]]"
        max-file-size="[[maxFileSize]]"
        unit="[[unit]]"
        max-files-reached="{{maxFilesReached}}">
        <vaadin-upload-ajax-uploader
          slot="uploader"
          files="{{files}}"
          url="[[target]]"
          method="[[method]]"
          headers="[[headers]]"
          timeout="[[timeout]]"
          with-credentials="[[withCredentials]]"
          form-data-name="[[formDataName]]"
          auto="[[!noAuto]]"
        ></vaadin-upload-ajax-uploader>
        <vaadin-button>Upload Files</vaadin-button>
      </vaadin-upload-multiple>
      <span>
        <slot name="drop-label-icon">
          <span part="drop-label-icon"></span>
        </slot>
        Drop Files here...
      </span>
      <dom-repeat items="[[files]]" as="file">
        <template>
          <vaadin-upload-file file="[[file]]"></vaadin-upload-file>
        </template>
      </dom-repeat>
    </vaadin-upload-dropzone>
  </template>

  <script>
    /**
     * `vaadin-upload`
     */
    class VaadinUpload extends Polymer.Element {
      static get is() {
        return 'vaadin-upload';
      }
      static get version() {
        return '3.0.0';
      }
      static get properties() {
        return {
          files: {
            type: Array,
            value() {
              return [];
            },
            notify: true,
          },
          target: {
            type: String,
            value: 'https://mockbin.com/request',
          },
          method: {
            type: String,
            value: 'POST',
          },
          headers: {
            type: Object,
            value: {},
          },
          accept: {
            type: String,
            value: '',
          },
          timeout: {
            type: Number,
            value: 0,
          },
          withCredentials: {
            type: Boolean,
            value: false,
          },
          formDataName: {
            type: String,
            value: 'file',
          },
          maxFileSize: {
            type: Number,
            value: Infinity,
          },
          maxFiles: {
            type: Number,
            value: Infinity,
          },
          maxFilesReached: {
            type: Boolean,
            notify: true,
            readOnly: true,
          },
          noAuto: {
            type: Boolean,
            value: false,
          },
          nodrop: {
            type: Boolean,
            reflectToAttribute: true,
            value() {
              try {
                return !!document.createEvent('TouchEvent');
              } catch (e) {
                return false;
              }
            },
          },
          unit: {
            type: String,
            value: 'B',
          }
        };
      }
      ready() {
        super.ready();
        this.$.upload.addEventListener('file-reject', (e) => {
          this.dispatchEvent(new CustomEvent('file-reject', {
            composed: true,
            detail: e.detail,
          }));
        });
      }
    }
    customElements.define(VaadinUpload.is, VaadinUpload);
  </script>
</dom-module>
